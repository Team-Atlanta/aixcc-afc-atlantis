Yoinked from crs-multilang, slimmed down for C, and adapted for our environment.
