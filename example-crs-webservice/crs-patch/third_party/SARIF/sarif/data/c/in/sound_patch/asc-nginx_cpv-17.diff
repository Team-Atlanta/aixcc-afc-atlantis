--- a/src/mail/ngx_mail_smtp_handler.c
+++ b/src/mail/ngx_mail_smtp_handler.c
@@ -833,7 +833,7 @@
 {
     if (s->args.nelts > 10) {
         ngx_str_set(&s->out, smtp_invalid_argument);
-        ngx_mail_close_connection(c);
+        s->quit = 1;
         return NGX_ERROR;
     }
 
